<% content_for :footer do %>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&callback=geoLocate"></script>
  <script type="text/javascript">
  $('#art_category').chosen({allow_single_deselect:true});
  </script>
<% end %>

<% content_for :head do %>
  <script type="text/javascript">

    function geoLocate(){
      if (navigator.geolocation)
      {
        navigator.geolocation.getCurrentPosition(loadMaps, loadMaps);
      }
    }
    function loadMaps(position) {
      var center;
      var zoom = 12;
      if (position.hasOwnProperty('message'))
      {
        center = new google.maps.LatLng(38.1167755604538, -97.763344475);
        zoom = 3;
      }
      else{
        center = new google.maps.LatLng(position.coords.latitude,position.coords.longitude)
      }

      var map = new google.maps.Map(document.getElementById("map_canvas"), {
        zoom: zoom,
        center: center,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        mapTypeControl: false
      });

      google.maps.event.addListener(map, "click", function(event) {
        $("input#art_latitude").val(event.latLng.lat());
        $("input#art_longitude").val(event.latLng.lng());
      });

    }

    $(function() {
      if ($("input#art_latitude").val() == "")
        $("input#art_latitude").val("Click on Map");
      if ($("input#art_longitude").val() == "")
        $("input#art_longitude").val("Click on Map");

      $("#new_form").submit(function() {
        $("#new_photo").hide();
        $("#uploading_photo").show();
        return true;
      });
    });
  </script>
<% end %>

<div id="pageMain" class="addNewArt">
  <div id="fullColumn">
    <div id="titleContent">
      <h2 class="withSubtext">Add New Art</h2>
    </div>
  </div>


  <div id="ltColumn">
	<%= render :partial => "layouts/flash", :locals => {:flash => flash} %>

    <% if @art.errors.delete(:location).present? %>
      <div class="errors">
        Please click on the map to choose a latitude or longitude, or enter an address.
      </div>
    <% end %>

    <% if @art.errors.delete(:geocode).present? %>
      <div class="errors">
        We couldn't locate the address you gave. Please give a more specific address so that we can locate the art.
      </div>
    <% end %>

    <% @art.errors.full_messages.each do |msg| %>
      <div class="errors">
        <%= msg %>
      </div>
    <% end %>

    <%= form_for @art, :html => {:multipart => true, :id => "new_form"} do |f| %>
      <ul class="new-art">
        <li>
          If you don't know something, leave it blank. For unknown titles, enter "Unknown" followed by the nearest location.
        </li>
        <li>
          <span class="small blue"><em><sup>*</sup> = required</em> </span>
        </li>

        <li>
          <label for="art_category">category<sup>*</sup></label>
          <%= f.select :category, categories, {}, {:multiple => true, :style => "width: 350px"}  %>
        </li>
        <li>
          <label for="art_title">title<sup>*</sup></label>
          <%= f.text_field :title %>
        </li>
        <li>
          <%= f.label :artist, "Artist/Founder(s)" %>
          <%= f.text_field :artist %>
        </li>
        <li>
          <%= f.label :year %>
          <%= f.text_field :year %>
        </li>
        <li>
          <%= f.label :website %>
          <%= f.text_field :website %>
        </li>
        <li>
          <%= f.label :location_description, "Describe the location" %>
          <%= f.text_area :location_description %>
        </li>
        <li>
          <%= f.label :description, "Describe the art" %>
          <%= f.text_area :description %>
        </li>
        <li class="formModule">
          <strong>Click on the map to enter the exact location, or fill in the approximate street address below.</strong><sup>*</sup>
        </li>
        <li>
          <%= f.label :latitude %>
          <%= f.text_field :latitude %>
        </li>
        <li>
          <%= f.label :longitude %>
          <%= f.text_field :longitude %>
        </li>
        <li>
          <span class="or">or</span>
        </li>
        <li>
          <%= f.label :address %>
          <%= f.text_field :address %>
        </li>
        <li>
          <%= f.label :city %>
          <%= f.text_field :city %>
        </li>
        <li>
          <%= f.label :state %>
          <%= f.text_field :state %>
        </li>
        <li>
          <%= f.label :zip %>
          <%= f.text_field :zip %>
        </li>
        <li class="formModule">
          <label>photo<sup>*</sup></label>
          <span class="tip">(<!--jpg, gif, or png only; -->6MB limit)</span>
          <%= file_field_tag 'new_photo' %>
          <div id="uploading_photo" style="display: none">
            <p>Uploading photo, please wait...</p>
          </div>
        </li>
        <li>
        <%=t :photo_attribution_text %> <%= text_field_tag 'photo_attribution_text' %>
        <%=t :photo_attribution_url %> <%= text_field_tag 'photo_attribution_url' %>
        </li>
        <li>
          <button class="submitBtn" name="submit" type="submit">
              <span>Submit</span>
          </button>


        </li>
      </ul>
    <% end %>
  </div>

  <div id="rtColumn">
	<div class="mapWrap">
	    <div id="map_canvas"></div>
	</div>
  </div>

  <div class="clear"></div>

</div>
