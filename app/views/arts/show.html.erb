<% content_for :footer do %>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&callback=loadMaps"></script>
<% end %>

<script type="text/javascript">
  var latitude = <%= @art.latitude || 0 %>;
  var longitude = <%= @art.longitude || 0 %>;
  
  var address = "<%= @art.address %>";
  var city = "<%= @art.city %>";
  var state = "<%= @art.state %>";
  var zip = "<%= @art.zip %>";

  // street view, point of view
  var heading = <%= @art.header || -1 %>;
  var pitch = <%= @art.pitch || -1 %>;
  var zoom = <%= @art.zoom || -1 %>;

  function loadMaps() {
    
    var location = new google.maps.LatLng(latitude, longitude);
    // regular map
    var map = new google.maps.Map(document.getElementById("map_canvas"), {
      zoom: 15,
      center: location,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      mapTypeControl: false
    });
    
    var marker = new google.maps.Marker({
      position: location
    });
    marker.setMap(map);
    
    // street view map
    if (heading >= 0 && pitch >= 0 && zoom >= 0) {
      var street = new google.maps.StreetViewPanorama(document.getElementById("pano"), {
        position: location,
        pov: {
          heading: heading,
          pitch: pitch,
          zoom: zoom
        },
        addressControl: false,
        navigationControlOptions: {
          style: google.maps.NavigationControlStyle.SMALL
        }
      });
    } else
      $("#pano").hide();
  }

  $(function() {

    $("#editInformation a").click(
      function() {
        $("#artworkMetaData").hide();
        $("#edit_artworkMetaData").show();
        $(".callout").hide();
        return false;
      }
    );
    
    $(".cancelBtn").click(
      function() {
        $("#artworkMetaData").show();
        $("#edit_artworkMetaData").hide();
        $(".callout").show();
        return false;
      }
    );
    
    <% if @submission.errors.any? %>
      // submission has errors, show the form
      $("#editInformation a").click();
    <% end %>
    
    <% if admin? %>
      $("div.delete_comment a").click(function() {
        if (confirm("Unapprove this comment?")) {
          var elem = $(this);
          $.post(elem.attr("href"), function() {
            location.href = "<%= art_url @art %>";
          });
        }
        return false;
      });
    <% end %>

  });
</script>

<div id="pageMain">
  
  <div id="fullColumn">
    <div id="titleContent">
      <h2 class="withSubtext withIcon">
        <%= @art.title %>
      </h2>
      
      <% if @art.commissioned %>
        <a href="http://dcarts.dc.gov/DC/DCARTS/">
          <span id="commissioned" title="Commissioned by the District">
            Commissioned by the city
          </span>
        </a>
      <% end %>
      
      <%= render :partial => "layouts/addthis" %>
      
      <% if admin? %>
        <div class="admin_art">
          <%= link_to "Admin", admin_art_path(@art) %>
        </div>
      <% end %>
      
      <div class="clear"></div>
    </div>
  </div>

  <div id="ltColumn">
    <div class="module">
      <% if @art.website.present? %>
        <dl id="artworkData">
          <dt>Artist's Website</dt>
          <dd><%= link_to @art.website, @art.website %></dd>
        </dl>
      <% end %>
        
      <div id="editInformation">
        <span class="callout">
          Know more information about this piece?
          <a href="#">Edit it now!</a>
        </span>
      </div>
      
      <dl id="artworkMetaData">
        <dt>Category</dt> 
        <dd><%= known @art.category %></dd>

        <dt>Artist(s)</dt>  
        <dd><%= known @art.artist %></dd>

        <dt>Year</dt> 
        <dd><%= known @art.year %></dd>

        <dt>Neighborhood</dt> 
        <dd><%= known @art.neighborhood %></dd>
        
        <dt>Ward</dt> 
        <dd><%= known @art.ward %></dd>

        <dt>Location</dt>
        <dd><%= known @art.location_description %></dd>

        <dt>Description</dt>  
        <dd><%= known @art.description %></dd>
      </dl>
      
      <%= form_for([@art, @submission], :url => submit_art_path(@art), :html => {:id => "edit_artworkMetaData", :style => "display: none"}) do |f| %>
        <ul>
        
          <li>
            <%= f.label :category %>
            <%= f.select :category, categories, {:include_blank => "---"} %>
          </li>
          
          <li>
            <%= f.label :artist, "Artist(s)" %>
            <%= f.text_field :artist %>
          </li>
          
          <li>
            <%= f.label :year %>
            <%= f.text_field :year %>
          </li>
          
          <li>
            <%= f.label :neighborhood %>
            <%= f.select :neighborhood, neighborhoods, {:include_blank => "---"} %>
          </li>
        
          <li>
            <%= f.label :ward %>
            <%= f.text_field :ward %>
          </li>
        
          <li>
            <%= f.label :location_description, "Location" %>
            <%= f.text_area :location_description %>
          </li>
          
          <li>
            <%= f.label :description %>
            <%= f.text_area :description %>
          </li>
          
          <li>
            <button class="submitBtn" type="submit">
                <span>Submit</span>
            </button>
          </li>
          <li>
            <a class="cancelBtn buttonLink " href="#">Cancel</a>
          </li> 
        </ul>
      <% end %>
      <div class="clear"></div>
      
    </div>
    
    <% if @art.comments.approved.any? %>
      <div class="module" id="comments">
        <h3>Comments</h3>
        
        <ol>
          <% @art.comments.approved.each_with_index do |comment, i| %>
            <li>
              <span class="commentNumber"><%= i + 1 %></span>
              <div class="commentMetaData">
                <span class="commentName">
                  <% if comment.url.present? %>
                    <a href="<%= comment.url %>"><%= comment.name %></a>
                  <% else %>
                    <%= comment.name %>
                  <% end %>
                </span>
                
                <span class="entryDate">
                  <%= comment.created_at.strftime "%B %d, %Y" %>
                </span>
                
                <p>
                  <%= comment.text %>
                </p>
              </div>
              
              <% if admin? %>
                <div class="delete_comment">
                  <%= link_to "Unapprove", unapprove_admin_art_comment_path(@art, comment) %>
                </div>
              <% end %>
              
              <div class="clear"></div>
            </li>
          <% end %>
        </ol>
        
      </div>
    <% end %>
    
    <div class="module">
      <h3>Leave a Comment</h3>
      
      <%= form_for([@art, @comment], :url => comment_art_path(@art)) do |f| %>
        <ul>
          <li>
            <%= f.label :name %>
            <%= f.text_field :name %>
          </li>
          <li>
            <%= f.label :email %>
            <%= f.text_field :email %>
          </li>
          <li>
            <%= f.label :url %>
            <%= f.text_field :url %>
          </li>
          <li>
            <%= f.label :text, "Comment" %>
            <%= f.text_area :text %>
          </li>
          <li>
            <button class="submitBtn" type="submit">
              <span>Submit</span>
            </button>
          </li>   
        </ul> 
      <% end %>
      
    </div>
  </div>

  <div id="rtColumn">
    <% if @art.flickr_ids and @art.flickr_ids.any? %>
      <div class="module" id="artworkPhoto">
      
        <% if @art.flickr_ids.size > 1 %>
          <iframe align="center" src="http://www.flickr.com/slideShow/index.gne?group_id=&user_id=<%= flickr_details[:account][:user_id] %>&set_id=&tags=<%= @art.slug %>" frameBorder="0" width="300" height="300" scrolling="no"></iframe>
        <% else %>
          <script type="text/javascript">
            var photo_id = "<%= @art.flickr_ids.first %>";
            Flickr.getThumbnail(photo_id, "Medium", function(thumbnail) {
              if (thumbnail) {
                var image = "<img src=\"" + thumbnail.source + "\" />";
                var html = "<a href=\"" + Flickr.photoUrl(photo_id) + "\">" + image + "</a>";
                $("#artworkPhoto").prepend(html);
              }
            });
          </script>
        <% end %>
        
        <span class="tip">
          All photos uploaded are published on <a href="http://flickr.com">Flickr</a> with a <a href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial license</a>.
        </span>
      </div>
    <% end %>
    
    <div class="module">
      <h3>Have <%= (@art.flickr_ids and @art.flickr_ids.any?) ? "Another" : "A" %> Photo? Upload it now!</h3>
      <%= form_tag add_photo_art_path(@art), :multipart => true, :id => "new_photo_form" do %>
        <%= file_field_tag 'new_photo' %>
        <label for="new_photo_username">Flickr Username (optional)</label>
        <%= text_field_tag 'new_photo_username' %>
        <%= submit_tag "Submit" %>
      <% end %>
    </div>
    
    <div id="map_canvas" class="smMap module"></div>
    <div name="pano" id="pano" class="module"></div>
  </div>

  <div class="clear"></div>

</div>